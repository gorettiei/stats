---
title: "mvpa_siemens"
author: "Goretti Espana-Irla"
date: '2024-05-09'
output: 
  html_document: 
    toc: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

#1. Load libraries and dataset

```{r}
#load libraries
install.packages("tidyverse")
install.packages("ggplot2")
install.packages("sjPlot")
install.packages("emmeans")

library(tidyverse)
library(dplyr)
library(tidyr)
library(tidymodels)
library(readr)
library(ggplot2)
library(sjPlot)
library(Matrix)
library(lme4)
library(lmerTest)

#setwd
setwd("/work/cnelab/fitbir/MVPA_siemens_project")


# Step 1: Delete specific columns from philips_df
# Deleting columns from index 5 to 1

mvpa_proj <- mvpa_proj[, -c(105:141)]

# Merge the selected columns with philips_df by "id"
mvpa_proj <- merge(mvpa_proj, cognition_track_tbi, by="id", all.x=TRUE)


# Convert relevant columns to numeric for 2 WEEKS
mvpa_proj$RAVLTPrincipalList1_two <- as.numeric(mvpa_proj$RAVLTPrincipalList1_two)
mvpa_proj$RAVLTPrincipalList2_two <- as.numeric(mvpa_proj$RAVLTPrincipalList2_two)
mvpa_proj$RAVLTPrincipalList3_two <- as.numeric(mvpa_proj$RAVLTPrincipalList3_two)
mvpa_proj$RAVLTPrincipalList4_two <- as.numeric(mvpa_proj$RAVLTPrincipalList4_two)
mvpa_proj$RAVLTPrincipalList5_two <- as.numeric(mvpa_proj$RAVLTPrincipalList5_two)

# Create RAVLT scores 2 WEEKS
mvpa_proj$RAVLTsum_two <- mvpa_proj$RAVLTPrincipalList1_two + mvpa_proj$RAVLTPrincipalList2_two + mvpa_proj$RAVLTPrincipalList3_two + mvpa_proj$RAVLTPrincipalList4_two + mvpa_proj$RAVLTPrincipalList5_two
mvpa_proj$RAVLTlearnt_two <- mvpa_proj$RAVLTPrincipalList5_two - mvpa_proj$RAVLTPrincipalList1_two

# Convert relevant columns to numeric for 6 MONTHS
mvpa_proj$RAVLTPrincipalList1_six <- as.numeric(mvpa_proj$RAVLTPrincipalList1_six)
mvpa_proj$RAVLTPrincipalList2_six <- as.numeric(mvpa_proj$RAVLTPrincipalList2_six)
mvpa_proj$RAVLTPrincipalList3_six <- as.numeric(mvpa_proj$RAVLTPrincipalList3_six)
mvpa_proj$RAVLTPrincipalList4_six <- as.numeric(mvpa_proj$RAVLTPrincipalList4_six)
mvpa_proj$RAVLTPrincipalList5_six <- as.numeric(mvpa_proj$RAVLTPrincipalList5_six)

# Create RAVLT scores 6 MONTHS
mvpa_proj$RAVLTsum_six <- mvpa_proj$RAVLTPrincipalList1_six + mvpa_proj$RAVLTPrincipalList2_six + mvpa_proj$RAVLTPrincipalList3_six + mvpa_proj$RAVLTPrincipalList4_six + mvpa_proj$RAVLTPrincipalList5_six
mvpa_proj$RAVLTlearnt_six <- mvpa_proj$RAVLTPrincipalList5_six - mvpa_proj$RAVLTPrincipalList1_six

# Convert relevant columns to numeric for 12 MONTHS
mvpa_proj$RAVLTPrincipalList1_twelve <- as.numeric(mvpa_proj$RAVLTPrincipalList1_twelve)
mvpa_proj$RAVLTPrincipalList2_twelve <- as.numeric(mvpa_proj$RAVLTPrincipalList2_twelve)
mvpa_proj$RAVLTPrincipalList3_twelve <- as.numeric(mvpa_proj$RAVLTPrincipalList3_twelve)
mvpa_proj$RAVLTPrincipalList4_twelve <- as.numeric(mvpa_proj$RAVLTPrincipalList4_twelve)
mvpa_proj$RAVLTPrincipalList5_twelve <- as.numeric(mvpa_proj$RAVLTPrincipalList5_twelve)

# Create RAVLT scores 12 MONTHS
mvpa_proj$RAVLTsum_twelve <- mvpa_proj$RAVLTPrincipalList1_twelve + mvpa_proj$RAVLTPrincipalList2_twelve + mvpa_proj$RAVLTPrincipalList3_twelve + mvpa_proj$RAVLTPrincipalList4_twelve + mvpa_proj$RAVLTPrincipalList5_twelve
mvpa_proj$RAVLTlearnt_twelve <- mvpa_proj$RAVLTPrincipalList5_twelve - mvpa_proj$RAVLTPrincipalList1_twelve




x <- as.factor(mvpa_proj$family_income)
levels(x)
mvpa_proj$SES[x == "Under $15,000"] <- 1
mvpa_proj$SES[x == "$15,000 to $24,999"] <- 2
mvpa_proj$SES[x == "$25,000 to $34,999"] <- 3
mvpa_proj$SES[x == "$35,000 to $49,999"] <- 4
mvpa_proj$SES[x == "$50,000 to $74,999"] <- 5
mvpa_proj$SES[x == "$75,000 to $99,999"] <- 6
mvpa_proj$SES[x == "$100,000 and over "] <- 7
mvpa_proj$SES[x == "Unknown"] <- NA
mvpa_proj$SES[x == "Refused"] <- NA

mvpa_proj$SES <- as.numeric(mvpa_proj$SES)

# Calculate mean and standard deviation of mvpa_proj$SES
summary_stats <- list(mean = mean(mvpa_proj$SES, na.rm = TRUE), 
                      sd = sd(mvpa_proj$SES, na.rm = TRUE))

# Print the results
summary_stats



write.csv(mvpa_proj,"/work/cnelab/fitbir/raw_csv/track_tbi.csv", row.names=FALSE)


#load datasets from .csv
mvpa_proj <- read_csv("/work/cnelab/fitbir/raw_csv/track_tbi.csv") 

View(mvpa_proj)
```

#2. Explore variables and transform

```{r}

# visualize variable distribution
hist(mvpa_proj$TMTPartBTime_two)
hist(mvpa_proj$TMTPartBTime_six)
hist(mvpa_proj$TMTPartBTime_twelve)
hist(mvpa_proj$RAVLTsum_two)
hist(mvpa_proj$RAVLTsum_six)
hist(mvpa_proj$RAVLTsum_twelve)
hist(mvpa_proj$RAVLTlearnt_two)
hist(mvpa_proj$RAVLTlearnt_six)
hist(mvpa_proj$RAVLTlearnt_twelve)
hist(mvpa_proj$WAISscore_two)
hist(mvpa_proj$WAISscore_six)
hist(mvpa_proj$WAISscore_twelve)

# transform to log and normal distribute variables
mvpa_proj$TMTPartBTime_two_log <- log(mvpa_proj$TMTPartBTime_two)
mvpa_proj$TMTPartBTime_six_log <- log(mvpa_proj$TMTPartBTime_six)
mvpa_proj$TMTPartBTime_twelve_log <- log(mvpa_proj$TMTPartBTime_twelve)

# re-visualize the new log variables
hist(mvpa_proj$TMTPartBTime_two_log)
hist(mvpa_proj$TMTPartBTime_six_log)
hist(mvpa_proj$TMTPartBTime_twelve_log)

# test correlation between fwd and behavior
cor.test(mvpa_proj$cluster6_1, mvpa_proj$TMTPartATime_two, method="pearson") 




# test correlation between fwd and behavior
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster1_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster2_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster3_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster4_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster5_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster6_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster7_1, method="pearson")
cor.test(mvpa_proj_cases$age, mvpa_proj_cases$cluster8_1, method="pearson")



mvpa_proj_cases <- mvpa_proj[mvpa_proj$case_control == "Case", ]


cor.test(mvpa_proj_cases$cluster6_1, mvpa_proj_cases$TMTPartATime_two, method="pearson")


# Scatter plot with trend line
plot(mvpa_proj_cases$age, mvpa_proj_cases$cluster6_1, 
     xlab = "Age", ylab = "Cluster6_1",
     main = "Scatter Plot of Age vs. Cluster6_1",
     pch = 16, col = "blue")

# Add a trend line
abline(lm(mvpa_proj_cases$cluster6_1 ~ mvpa_proj_cases$age), col = "red", lwd = 2)



cases_mvpa_proj <- mvpa_proj[mvpa_proj$case_control == "Case", ]

controls_mvpa_proj <- mvpa_proj[mvpa_proj$case_control == "Control", ]



mean(cases_mvpa_proj$SES, na.rm = TRUE)
sd(cases_mvpa_proj$SES, na.rm = TRUE)


mean(controls_mvpa_proj$SES, na.rm = TRUE)
sd(controls_mvpa_proj$SES, na.rm = TRUE)
```

#3. Convert in long format and create time variable

```{r}
# Gather the data into long format (TMTl not normal distributed)
long_df_TMT <- gather(mvpa_proj, key = "time", value = "TMTPartBTime", TMTPartBTime_two, TMTPartBTime_six, TMTPartBTime_twelve)

# Create a new column based on the values in the "time" column
long_df_TMT <- long_df_TMT %>%
  mutate(timepoint = case_when(
    time == "TMTPartBTime_two" ~ "timepoint1",
    time == "TMTPartBTime_six" ~ "timepoint2",
    time == "TMTPartBTime_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))


# Gather the data into long format (TMTl not normal distributed)
long_df_TMTA <- gather(mvpa_proj, key = "time", value = "TMTPartATime", TMTPartATime_two, TMTPartATime_six, TMTPartATime_twelve)

# Create a new column based on the values in the "time" column
long_df_TMTA <- long_df_TMTA %>%
  mutate(timepoint = case_when(
    time == "TMTPartATime_two" ~ "timepoint1",
    time == "TMTPartATime_six" ~ "timepoint2",
    time == "TMTPartATime_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))


# Gather the data into long format (TMTlog)
#long_df_TMT <- gather(mvpa_proj, key = "time", value = "TMTPartBTime", TMTPartBTime_two_log, TMTPartBTime_six_log, TMTPartBTime_twelve_log)

# Create a new column based on the values in the "time" column
#long_df_TMT <- long_df_TMT %>%
#  mutate(timepoint = case_when(
#    time == "TMTPartBTime_two_log" ~ "timepoint1",
#    time == "TMTPartBTime_six_log" ~ "timepoint2",
#    time == "TMTPartBTime_twelve_log" ~ "timepoint3",
#    TRUE ~ NA_character_
#  ))

# Gather the data into long format
long_df_WAIS <- gather(mvpa_proj, key = "time", value = "WAISscore", WAISscore_two, WAISscore_six, WAISscore_twelve)

# Create a new column based on the values in the "time" column
long_df_WAIS <- long_df_WAIS %>%
  mutate(timepoint = case_when(
    time == "WAISscore_two" ~ "timepoint1",
    time == "WAISscore_six" ~ "timepoint2",
    time == "WAISscore_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))


# Gather the data into long format
long_df_RAVLTsum <- gather(mvpa_proj, key = "time", value = "RAVLTsum", RAVLTsum_two, RAVLTsum_six, RAVLTsum_twelve)

# Create a new column based on the values in the "time" column
long_df_RAVLTsum <- long_df_RAVLTsum %>%
  mutate(timepoint = case_when(
    time == "RAVLTsum_two" ~ "timepoint1",
    time == "RAVLTsum_six" ~ "timepoint2",
    time == "RAVLTsum_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))

# Gather the data into long format
long_df_RAVLTlearnt <- gather(mvpa_proj, key = "time", value = "RAVLTlearnt", RAVLTlearnt_two, RAVLTlearnt_six, RAVLTlearnt_twelve)

# Create a new column based on the values in the "time" column
long_df_RAVLTlearnt <- long_df_RAVLTlearnt %>%
  mutate(timepoint = case_when(
    time == "RAVLTlearnt_two" ~ "timepoint1",
    time == "RAVLTlearnt_six" ~ "timepoint2",
    time == "RAVLTlearnt_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))


```

#4. Slipt the sample in cases/controls

```{r}
# Filter data for cases
cases_long_df_TMT <- long_df_TMT[long_df_TMT$case_control == "Case", ]
cases_long_df_WAIS <- long_df_WAIS[long_df_WAIS$case_control == "Case", ]
cases_long_df_RAVLTsum <- long_df_RAVLTsum[long_df_RAVLTsum$case_control == "Case", ]
cases_long_df_RAVLTlearnt <- long_df_RAVLTlearnt[long_df_RAVLTlearnt$case_control == "Case", ]
cases_long_df_TMTA <- long_df_TMTA[long_df_TMTA$case_control == "Case", ]
```

#5.Mixed effect model with time interaction

```{r}

# Load the required library
library(Matrix)
library(lme4)
library(lmerTest)


## TMT Part A Linear Mixed Effects Model + interaction plot

#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
cases_long_df_TMTA$sex <- as.factor(cases_long_df_TMTA$sex)
cases_long_df_TMTA$age <- as.numeric(cases_long_df_TMTA$age)
cases_long_df_TMTA$educ <- as.numeric(cases_long_df_TMTA$educ)
cases_long_df_TMTA$QC_MeanMotion <- as.numeric(cases_long_df_TMTA$QC_MeanMotion)
cases_long_df_TMTA$timepoint[cases_long_df_TMTA$timepoint == "timepoint1"] <- "1"
cases_long_df_TMTA$timepoint[cases_long_df_TMTA$timepoint == "timepoint2"] <- "2"
cases_long_df_TMTA$timepoint[cases_long_df_TMTA$timepoint == "timepoint3"] <- "3"
cases_long_df_TMTA$timepoint <- as.numeric(cases_long_df_TMTA$timepoint)
cases_long_df_TMTA$TMTPartATime <- as.numeric(cases_long_df_TMTA$TMTPartATime)

sum(is.na(cases_long_df_TMTA$TMTPartATime))


tmta_tbi_lme1 <- lmer(TMTPartATime ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster1_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme2 <- lmer(TMTPartATime ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster2_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme3 <- lmer(TMTPartATime ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster3_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme4 <- lmer(TMTPartATime ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster4_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme5 <- lmer(TMTPartATime ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster5_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme6 <- lmer(TMTPartATime ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster6_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme7 <- lmer(TMTPartATime ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster7_1|id), data = cases_long_df_TMTA)
tmta_tbi_lme8 <- lmer(TMTPartATime ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster8_1|id), data = cases_long_df_TMTA)

summary(tmta_tbi_lme1)
summary(tmta_tbi_lme2)
summary(tmta_tbi_lme3)
summary(tmta_tbi_lme4)
summary(tmta_tbi_lme5)
summary(tmta_tbi_lme6)
summary(tmta_tbi_lme7)
summary(tmta_tbi_lme8)


library(sjPlot)
tab_model(tmta_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmta_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")

# Load required libraries
library(ggplot2)
library(dplyr)
library(interactions)

jn_intervals <- probe_interaction()

# interaction plot of significant cluster
test2 <- probe_interaction(model = tmta_tbi_lme3, pred = timepoint, modx = cluster3_1, alpha = .05, ci = 0.95, fdr = TRUE) 

test2 

# For model tmta_tbi_lme3
library(interactions)

# Create the plot with data points but no confidence interval shading
plot_with_points_model3 <- interact_plot(
  model = tmta_tbi_lme3,
  pred = timepoint,
  modx = cluster3_1,
  plot.points = TRUE,         # This adds the data points
  point.alpha = 0.3,          # Makes points semi-transparent to reduce overplotting
  jitter = 0.2,               # Adds jitter to points for better visibility
  ci = FALSE,                 # Remove confidence intervals
  interval = FALSE            # Also ensure interval is set to FALSE
) +
  # Set y-axis limits appropriate for TMT-A (you may need to adjust these)
  scale_y_continuous(limits = c(0, 70))  # Adjust these values based on your TMT-A data

# Display the plot
plot_with_points_model3


test3 <- probe_interaction(model = tmta_tbi_lme7, pred = timepoint, modx = cluster7_1, alpha = .05, ci = 0.95, fdr = TRUE) 

test3 

# For model tmta_tbi_lme7
library(interactions)

# Create the plot with data points but no confidence interval shading
plot_with_points_model7 <- interact_plot(
  model = tmta_tbi_lme7,
  pred = timepoint,
  modx = cluster7_1,
  plot.points = TRUE,         # This adds the data points
  point.alpha = 0.3,          # Makes points semi-transparent to reduce overplotting
  jitter = 0.2,               # Adds jitter to points for better visibility
  ci = FALSE,                 # Remove confidence intervals
  interval = FALSE            # Also ensure interval is set to FALSE
) +
   # Set y-axis limits appropriate for TMT-A (you may need to adjust these)
  scale_y_continuous(limits = c(0, 70))  # Adjust these values based on your TMT-A data

# Display the plot
plot_with_points_model7




## TMT Part B Linear Mixed Effects Model + interaction plot

#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
cases_long_df_TMT$sex <- as.factor(cases_long_df_TMT$sex)
cases_long_df_TMT$age <- as.numeric(cases_long_df_TMT$age)
cases_long_df_TMT$educ <- as.numeric(cases_long_df_TMT$educ)
cases_long_df_TMT$QC_MeanMotion <- as.numeric(cases_long_df_TMT$QC_MeanMotion)
cases_long_df_TMT$timepoint[cases_long_df_TMT$timepoint == "timepoint1"] <- "1"
cases_long_df_TMT$timepoint[cases_long_df_TMT$timepoint == "timepoint2"] <- "2"
cases_long_df_TMT$timepoint[cases_long_df_TMT$timepoint == "timepoint3"] <- "3"
cases_long_df_TMT$timepoint <- as.numeric(cases_long_df_TMT$timepoint)
cases_long_df_TMT$TMTPartBTime <- as.numeric(cases_long_df_TMT$TMTPartBTime)


sum(is.na(cases_long_df_TMT$TMTPartBTime))

tmtb_tbi_lme1 <- lmer(TMTPartBTime ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster1_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme2 <- lmer(TMTPartBTime ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster2_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme3 <- lmer(TMTPartBTime ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster3_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme4 <- lmer(TMTPartBTime ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster4_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme5 <- lmer(TMTPartBTime ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster5_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme6 <- lmer(TMTPartBTime ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster6_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme7 <- lmer(TMTPartBTime ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster7_1|id), data = cases_long_df_TMT)
tmtb_tbi_lme8 <- lmer(TMTPartBTime ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster8_1|id), data = cases_long_df_TMT)

summary(tmtb_tbi_lme1)
summary(tmtb_tbi_lme2)
summary(tmtb_tbi_lme3)
summary(tmtb_tbi_lme4)
summary(tmtb_tbi_lme5)
summary(tmtb_tbi_lme6)
summary(tmtb_tbi_lme7)
summary(tmtb_tbi_lme8)


library(sjPlot)
tab_model(tmtb_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtb_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")

# Load required libraries
library(ggplot2)
library(dplyr)
library(interactions)

jn_intervals <- probe_interaction()

# interaction plot of significant cluster
test <- probe_interaction(model = tmtb_tbi_lme6, pred = timepoint, modx = cluster6_1, alpha = .05, ci = 0.95, fdr = TRUE) 


test 


# Create the plot with data points
plot_with_points <- interact_plot(
  model = tmtb_tbi_lme6,
  pred = timepoint,
  modx = cluster6_1,
  plot.points = TRUE,         # This adds the data points
  point.alpha = 0.3,          # Makes points semi-transparent to reduce overplotting
  jitter = 0.2,               # Adds jitter to points for better visibility
  ci = TRUE,                  # Keep confidence intervals
  interval = FALSE             # Show confidence intervals
) +
# Set y-axis limits from 55 to 90
  scale_y_continuous(limits = c(0, 170))

# Display the plot
plot_with_points



## WAIS Linear Mixed Effects Model + interaction plot
#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
cases_long_df_WAIS$sex <- as.factor(cases_long_df_WAIS$sex)
cases_long_df_WAIS$age <- as.numeric(cases_long_df_WAIS$age)
cases_long_df_WAIS$educ <- as.numeric(cases_long_df_WAIS$educ)
cases_long_df_WAIS$QC_MeanMotion <- as.numeric(cases_long_df_WAIS$QC_MeanMotion)
cases_long_df_WAIS$timepoint[cases_long_df_WAIS$timepoint == "timepoint1"] <- "1"
cases_long_df_WAIS$timepoint[cases_long_df_WAIS$timepoint == "timepoint2"] <- "2"
cases_long_df_WAIS$timepoint[cases_long_df_WAIS$timepoint == "timepoint3"] <- "3"
cases_long_df_WAIS$timepoint <- as.numeric(cases_long_df_WAIS$timepoint)
cases_long_df_WAIS$WAISscore <- as.numeric(cases_long_df_WAIS$WAISscore)


sum(is.na(cases_long_df_WAIS$WAISscore))

wais_tbi_lme1 <- lmer(WAISscore ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster1_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme2 <- lmer(WAISscore ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster2_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme3 <- lmer(WAISscore ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster3_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme4 <- lmer(WAISscore ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster4_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme5 <- lmer(WAISscore ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster5_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme6 <- lmer(WAISscore ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster6_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme7 <- lmer(WAISscore ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster7_1 |id), data = cases_long_df_WAIS)
wais_tbi_lme8 <- lmer(WAISscore ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster8_1 |id), data = cases_long_df_WAIS)


summary(wais_tbi_lme1)
summary(wais_tbi_lme2)
summary(wais_tbi_lme3)
summary(wais_tbi_lme4)
summary(wais_tbi_lme5)
summary(wais_tbi_lme6)
summary(wais_tbi_lme7)
summary(wais_tbi_lme8)


library(sjPlot)
tab_model(wais_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(wais_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")


## RAVLT sum Linear Mixed Effects Model + interaction plot

#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
cases_long_df_RAVLTsum$sex <- as.factor(cases_long_df_RAVLTsum$sex)
cases_long_df_RAVLTsum$age <- as.numeric(cases_long_df_RAVLTsum$age)
cases_long_df_RAVLTsum$educ <- as.numeric(cases_long_df_RAVLTsum$educ)
cases_long_df_RAVLTsum$QC_MeanMotion <- as.numeric(cases_long_df_RAVLTsum$QC_MeanMotion)
cases_long_df_RAVLTsum$timepoint[cases_long_df_RAVLTsum$timepoint == "timepoint1"] <- "1"
cases_long_df_RAVLTsum$timepoint[cases_long_df_RAVLTsum$timepoint == "timepoint2"] <- "2"
cases_long_df_RAVLTsum$timepoint[cases_long_df_RAVLTsum$timepoint == "timepoint3"] <- "3"
cases_long_df_RAVLTsum$timepoint <- as.numeric(cases_long_df_RAVLTsum$timepoint)
cases_long_df_RAVLTsum$RAVLTsum <- as.numeric(cases_long_df_RAVLTsum$RAVLTsum)


sum(is.na(cases_long_df_RAVLTsum$RAVLTsum))

ravltsum_tbi_lme1 <- lmer(RAVLTsum ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster1_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme2 <- lmer(RAVLTsum ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster2_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme3 <- lmer(RAVLTsum ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster3_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme4 <- lmer(RAVLTsum ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster4_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme5 <- lmer(RAVLTsum ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster5_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme6 <- lmer(RAVLTsum ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster6_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme7 <- lmer(RAVLTsum ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster7_1 |id), data = cases_long_df_RAVLTsum)
ravltsum_tbi_lme8 <- lmer(RAVLTsum ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster8_1 |id), data = cases_long_df_RAVLTsum)


summary(ravltsum_tbi_lme1)
summary(ravltsum_tbi_lme2)
summary(ravltsum_tbi_lme3)
summary(ravltsum_tbi_lme4)
summary(ravltsum_tbi_lme5)
summary(ravltsum_tbi_lme6)
summary(ravltsum_tbi_lme7)
summary(ravltsum_tbi_lme8)

library(sjPlot)
tab_model(ravltsum_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltsum_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")


## RAVLT learnt Linear Mixed Effects Model + interaction plot

#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
cases_long_df_RAVLTlearnt$sex <- as.factor(cases_long_df_RAVLTlearnt$sex)
cases_long_df_RAVLTlearnt$age <- as.numeric(cases_long_df_RAVLTlearnt$age)
cases_long_df_RAVLTlearnt$educ <- as.numeric(cases_long_df_RAVLTlearnt$educ)
cases_long_df_RAVLTlearnt$QC_MeanMotion <- as.numeric(cases_long_df_RAVLTlearnt$QC_MeanMotion)
cases_long_df_RAVLTlearnt$timepoint[cases_long_df_RAVLTlearnt$timepoint == "timepoint1"] <- "1"
cases_long_df_RAVLTlearnt$timepoint[cases_long_df_RAVLTlearnt$timepoint == "timepoint2"] <- "2"
cases_long_df_RAVLTlearnt$timepoint[cases_long_df_RAVLTlearnt$timepoint == "timepoint3"] <- "3"
cases_long_df_RAVLTlearnt$timepoint <- as.numeric(cases_long_df_RAVLTlearnt$timepoint)
cases_long_df_RAVLTlearnt$RAVLTlearnt <- as.numeric(cases_long_df_RAVLTlearnt$RAVLTlearnt)

sum(is.na(cases_long_df_RAVLTlearnt$RAVLTlearnt))

ravltlearnt_tbi_lme1 <- lmer(RAVLTlearnt ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster1_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme2 <- lmer(RAVLTlearnt ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster2_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme3 <- lmer(RAVLTlearnt ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster3_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme4 <- lmer(RAVLTlearnt ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster4_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme5 <- lmer(RAVLTlearnt ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster5_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme6 <- lmer(RAVLTlearnt ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster6_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme7 <- lmer(RAVLTlearnt ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster7_1 |id), data = cases_long_df_RAVLTlearnt)
ravltlearnt_tbi_lme8 <- lmer(RAVLTlearnt ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + site_numeric + SES + (1+cluster8_1 |id), data = cases_long_df_RAVLTlearnt)

summary(ravltlearnt_tbi_lme1)
summary(ravltlearnt_tbi_lme2)
summary(ravltlearnt_tbi_lme3)
summary(ravltlearnt_tbi_lme4)
summary(ravltlearnt_tbi_lme5)
summary(ravltlearnt_tbi_lme6)
summary(ravltlearnt_tbi_lme7)
summary(ravltlearnt_tbi_lme8)



library(sjPlot)
tab_model(ravltlearnt_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(ravltlearnt_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")


# interaction plot of significant cluster
interact_plot(model = ravltlearnt_tbi_lme8, pred = timepoint, modx = cluster8_1) 
test2 <- probe_interaction(model = ravltlearnt_tbi_lme8, pred = timepoint, modx = cluster8_1, alpha = .05, ci = 0.95, fdr = TRUE) 

test2
tab_model(ravltlearnt_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
```

# 6.Control for multiple comparisons using false descovery rate (FDR)

```{r}
#CONTROL FOR MULTIPLE COMPARISONS USING FALSE DISCOVERY RATE (FDR)
library(readxl) #need to create excel or csv of pvalues from all models
pvals <- read_excel("Desktop/pvals.xlsx", sheet = "Hoja1")
View(pvals)
pvals$fdrval<-p.adjust(pvals$pvals, method="fdr")



#save csv file
write.csv(pvals,"/work/cnelab/fitbir/MVPA_siemens_project/pvalstmta.csv", row.names=FALSE)

```

# 7. Export model results in excel

```{r}
# Install required package if not already installed
# install.packages("writexl")

# Load required library
library(writexl)

# Store your models in a list
models <- list(
  wais_tbi_lme1,
  wais_tbi_lme2,
  wais_tbi_lme3,
  wais_tbi_lme4,
  wais_tbi_lme5,
  wais_tbi_lme6,
  wais_tbi_lme7,
  wais_tbi_lme8
)

# Create a list to store the summary results
model_summaries <- lapply(models, summary)

# Define names for the models
model_names <- c("wais_tbi_lme1", "wais_tbi_lme2", "wais_tbi_lme3", "wais_tbi_lme4",
                 "wais_tbi_lme5", "wais_tbi_lme6", "wais_tbi_lme7", "wais_tbi_lme8")

# Create a directory to store the Excel files if it doesn't exist
if (!file.exists("model_summaries")) {
  dir.create("model_summaries")
}

# Loop through each model, capture the summary as text, and write it to an Excel file
for (i in seq_along(model_summaries)) {
  summary_text <- capture.output(model_summaries[[i]])
  writeLines(summary_text, paste0("model_summaries/", model_names[i], "_summary.txt"))
}



# Set the directory where your model summaries are saved
model_summaries_directory <- "/work/cnelab/fitbir/MVPA_siemens_project/model_summaries"

# List all text files in the directory
text_files <- list.files(path = model_summaries_directory, pattern = "\\.txt$", full.names = TRUE)

# Set the directory where your CSV files will be saved
csv_files_directory <- "/work/cnelab/fitbir/MVPA_siemens_project/model_summaries_csv"

# Create the directory if it doesn't exist
if (!dir.exists(csv_files_directory)) {
  dir.create(csv_files_directory)
}

# Write each parsed summary to a separate CSV file
for (file in text_files) {
  # Read the content of the text file
  summary_text <- readLines(file)
  
  # Define the file path for the CSV file
  csv_file_path <- file.path(csv_files_directory, paste0(tools::file_path_sans_ext(basename(file)), ".csv"))
  
  # Write the parsed summary to a CSV file
  write.csv(data.frame(summary_text), csv_file_path, row.names = FALSE)
}
```

# 8. Boxplots to show results

```{r}

library(ggplot2)

# Basic violin plot with points, custom colors for violins, white background, and custom axis labels
ggplot(mvpa_proj, aes(x=case_control, y=cluster8_1, fill=case_control)) + 
  geom_violin(trim=FALSE) +
  geom_jitter(width=0.2, size=1.5, color="black") +  # Add points with a specific color
  scale_fill_manual(values=c("case"="#00FF00", "control"="#FFA500")) +  # Change violin colors using hexadecimal codes
  labs(x="Tbi Status", y="Cluster 8.1 Value", title="Violin Plot of Cluster 8.1 by Group") +  # Change axis labels and add title
  theme_classic()  # Apply a classic theme for white background


# Convert case_control to a factor with the correct levels
mvpa_proj$case_control <- factor(mvpa_proj$case_control, levels = c("Case", "Control"))

# Assuming your data is in a data frame called mvpa_proj
# Example structure of mvpa_proj:
# mvpa_proj <- data.frame(
#   cluster3_1 = c(...),
#   cases_controls = c('case', 'control', 'case', ...)
# )

# Calculate the mean value of cluster3_1 for cases
mean_cases <- mean(mvpa_proj$cluster7_1[mvpa_proj$case_control == 'Case'], na.rm = TRUE)

# Calculate the mean value of cluster3_1 for controls
mean_controls <- mean(mvpa_proj$cluster7_1[mvpa_proj$case_control == 'Control'], na.rm = TRUE)

# Output the results
cat("Mean value of cluster3_1 for cases:", mean_cases, "\n")
cat("Mean value of cluster3_1 for controls:", mean_controls, "\n")


# Create the plot with the updated case_control variable
ggplot(mvpa_proj, aes(x=case_control, y=cluster7_1, fill=case_control, color=case_control)) + 
  geom_violin(trim=FALSE, alpha=0.5) +  # Add alpha to make the violin plot semi-transparent
  geom_boxplot(width=0.1, position=position_dodge(0.9), alpha=0.7) +  # Add box plot with semi-transparency
  geom_jitter(width=0.2, size=1.5) +  # Add points with default color
  scale_fill_manual(values=c("Case"="#336600", "Control"="#999900")) +  # Change violin fill colors using hexadecimal codes
  scale_color_manual(values=c("Case"="#336600", "Control"="#999900")) +  # Change color of points using hexadecimal codes
  labs(x="TBI Status", y="Connectivity between Frontal Pole and ACC") +  # Change axis labels and add title
  theme_classic()  # Apply a classic theme for white background





#Box Plot with Jittered Points and Mean
ggplot(mvpa_proj, aes(x=case_control, y=cluster8_1, fill=case_control)) + 
  geom_boxplot(alpha=0.5, outlier.shape=NA) +  # Box plot with semi-transparency and without outliers
  stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", position=position_dodge(0.75)) +  # Mean points
  geom_jitter(width=0.2, size=1.5, color="black", alpha=0.7) +  # Jittered points
  scale_fill_manual(values=c("case"="#00FF00", "control"="#FFA500")) +  # Custom colors
  labs(x="Tbi Status", y="Cluster 8.1 Value", title="Box Plot with Mean and Jittered Points") +  # Labels and title
  theme_classic()  # White background


#Violin Plot with Box Plot and Mean (No Jittered Points)
ggplot(mvpa_proj, aes(x=case_control, y=cluster6_1, fill=case_control)) + 
  geom_violin(trim=FALSE, alpha=0.5) +  # Violin plot with semi-transparency
  geom_boxplot(width=0.1, position=position_dodge(0.9), alpha=0.7, outlier.shape=NA) +  # Box plot without outliers
  stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", position=position_dodge(0.9)) +  # Mean points
  scale_fill_manual(values=c("case"="#00FF00", "control"="#FFA500")) +  # Custom colors
  labs(x="Tbi Status", y="Cluster 8.1 Value", title="Violin Plot with Box Plot and Mean") +  # Labels and title
  theme_classic()  # White background

#Dot Plot with Mean and Standard Error

ggplot(mvpa_proj, aes(x=case_control, y=cluster8_1, color=case_control)) + 
  geom_point(position=position_jitter(width=0.2), size=1.5) +  # Jittered points
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.2, color="black", position=position_dodge(0.9)) +  # Error bars for mean ± SE
  stat_summary(fun=mean, geom="point", shape=18, size=3, color="red", position=position_dodge(0.9)) +  # Mean points
  scale_color_manual(values=c("case"="#00FF00", "control"="#FFA500")) +  # Custom colors
  labs(x="Tbi Status", y="Cluster 8.1 Value", title="Dot Plot with Mean and Standard Error") +  # Labels and title
  theme_classic()  # White background



# plot TMTB difference (timepoint 3 - timepoint 1) and FC of significant cluster

library(dplyr)
library(ggplot2)

# Calculate the difference between timepoint3 and timepoint1
cases_long_df_TMT <- cases_long_df_TMT %>%
  group_by(id) %>%
  filter(any(timepoint == "timepoint1") & any(timepoint == "timepoint3")) %>%
  mutate(diff_TMTPartBTime = TMTPartBTime[timepoint == "timepoint3"] - TMTPartBTime[timepoint == "timepoint1"]) %>%
  ungroup()


# Plotting the difference against cluster6_1 with customized colors
ggplot(cases_long_df_TMT, aes(x = diff_TMTPartBTime, y = cluster6_1)) +
  geom_point(color = "darkgreen", size = 3) +  # Change dot color to blue and increase size
  geom_smooth(method = "lm", se = FALSE, color = "darkorange") +  # Change line color to red
  labs(x = "TMTPartB difference (timepoint 3 - timepoint 1)", y = "FC frontal pole/mcc") +
  theme(panel.background = element_rect(fill = "lightgrey"))  # Change background color to light gray

```

# 9. Radar chart

```{r setup, include=FALS}

# Install and load the fmsb package if not already installed
if (!require(fmsb)) {
  install.packages("fmsb")
}
library(fmsb)

# Creating the networks data frame
networks <- data.frame(
    `Default Mode Network` = c(10),
    `Fontoparietal` = c(10),
    `Salience` = c(3.7),
    `Dorsal Attention` = c(8.7),
    `Somatomotor` = c(4),
    `Limbic` = c(7),
    `Visual` = c(5)
)

# Creating the max_min data frame with correct column names
max_min <- data.frame(
    `Default Mode Network` = c(30, 0),
    `Frontoparietal` = c(30, 0),  
    `Salience` = c(20, 0),
    `Dorsal Attention` = c(20, 0),
    `Somatomotor` = c(50, 0),
    `Limbic` = c(20, 0),
    `Visual` = c(20, 0)
)

# Calculate maximum values for each axis
max_values <- apply(networks_plot, 2, max)

# Creating the radar chart with a round shape
radarchart(
    networks_plot, axistype = 1, 
    # Customizing the plot appearance
    pcol = c("#00AFBB", "#00AFBB"),    # Colors for the lines
    pfcol = c(rgb(0.2,0.8,0.5,0.5), rgb(0.8,0.2,0.5,0.5)), # New colors for the filled areas
    plwd = 2,                   # Line width
    plty = 1,                   # Line type
    cglcol = "grey",            # Color of the grid lines
    cglty = 1,                  # Type of the grid lines
    axislabcol = "grey",
    caxislabels = seq(0, 20, 5), 
    vlabels = rep(NA, ncol(networks_plot)), 
    paxis = seq(0, 2 * pi, length.out = ncol(networks_plot) + 1)[-1] + pi/2,  # Adjust angles to align with axes
    centerzero = TRUE          # Center the radar chart at zero
)

# Add custom points manually
colors <- c("maroon", "darkblue", "darkolivegreen", "darkorange", "bisque4", "darkgoldenrod1", "cornflowerblue")
radius <- 1  # Adjust radius as needed

# Calculate angles for each axis
angles <- seq(0, 26 * pi, length.out = ncol(networks_plot) + 1)[-1] - pi/14


for (i in seq_along(labels)) {
  angle <- angles[i]
  x <- cos(angle) * radius
  y <- sin(angle) * radius
  points(x, y, col = colors[i], pch = 20, cex = 7)
}

# Add legend
legend("topright", legend = labels, col = colors, pch = 20, pt.cex = 1.5, cex = 0.8, bty = "n")
















{r}
# Define the data frame with actual values and maximum ranges
techs12 <- data.frame(
  `Default Mode Network` = c(0.1),
  `Frontoparietal` = c(1),
  `Salience` = c(1),
  `Dorsal Attention` = c(0.1),
  `Somatomotor` = c(0.1),
  `Limbic` = c(0.1),
  `Visual` = c(0.11)
)

max_min <- data.frame(
  `Default Mode Network` = c(4, 0),
  `Frontoparietal` = c(4, 0),
  `Salience` = c(4, 0),
  `Dorsal Attention` = c(4, 0),
  `Somatomotor` = c(4, 0),
  `Limbic` = c(4, 0),
  `Visual` = c(4, 0)
)

techs12_plot <- rbind(max_min, techs12)

radarchart(
  techs12_plot, axistype = 1,
  pcol = "darkblue",                           # Line color
  pfcol = rgb(0/255, 0/255, 139/255, 0.5),   # Fill color for the polygons (black with transparency)
  plwd = 2,                                       # Line width
  plty = 1,                                       # Line type
  cglcol = "grey",                                # Color of the grid lines
  cglty = 1,                                      # Type of the grid lines
  axislabcol = "grey",                            # Color of the axis labels
  caxislabels = seq(0, 5, 1),                     # Axis labels (not used when vlabels is set)
  vlabels = rep(NA, ncol(techs12_plot)),          # Hides the axis labels
  vlcex = 0.8                                     # Font size for the variable labels
)


#colors used:

#darkblue = rgb(0/255, 0/255, 139/255, 0.5)

#indianred1 = rgb(255/255, 106/255, 106/255, 0.5)

#orange = rgb(255/255, 165/255, 0/255, 0.5)

#dark_orchid = rgb(153/255, 50/255, 204/255, 0.5)

```

```{r}
# Calculate mean and SD of cluster6_1
mean_cluster6_1 <- mean(cases_long_df_TMT$cluster6_1, na.rm = TRUE)
sd_cluster6_1 <- sd(cases_long_df_TMT$cluster6_1, na.rm = TRUE)

# Define values for +1 SD, Mean, and -1 SD of cluster6_1
cluster6_1_plus1sd <- mean_cluster6_1 + sd_cluster6_1
cluster6_1_mean <- mean_cluster6_1
cluster6_1_minus1sd <- mean_cluster6_1 - sd_cluster6_1

# Subset data based on cluster6_1 SD groups and remove NA values
subset_plus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 > cluster6_1_plus1sd, ]
subset_mean <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 <= cluster6_1_plus1sd & cases_long_df_TMT$cluster6_1 > cluster6_1_minus1sd, ]
subset_minus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 <= cluster6_1_minus1sd, ]

# Create a combined data frame for plotting if subsets have rows
plot_data <- NULL
if (nrow(subset_plus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_plus1sd$cluster6_1, group = "+1 SD"))
}
if (nrow(subset_mean) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_mean$cluster6_1, group = "Mean"))
}
if (nrow(subset_minus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_minus1sd$cluster6_1, group = "-1 SD"))
}

# Plotting boxplot using ggplot2 if plot_data is not NULL
if (!is.null(plot_data)) {
  ggplot(plot_data, aes(x = group, y = cluster6_1, fill = group)) +
    geom_boxplot() +
    labs(x = "Cluster6_1 SD Group", y = "Cluster6_1 Values") +
    ggtitle("Boxplot of Cluster6_1 Values by SD Groups") +
    scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD"))  # Arrange x-axis in desired order
} else {
  message("No valid data points found for one or more SD groups.")
}





# Calculate mean and SD of cluster6_1
mean_cluster6_1 <- mean(cases_long_df_TMT$cluster6_1, na.rm = TRUE)
sd_cluster6_1 <- sd(cases_long_df_TMT$cluster6_1, na.rm = TRUE)

# Calculate mean and SD of cluster6_1
mean_cluster3_1 <- mean(cases_long_df_TMT$cluster3_1, na.rm = TRUE)
sd_cluster3_1 <- sd(cases_long_df_TMT$cluster3_1, na.rm = TRUE)

# Calculate mean and SD of cluster6_1
mean_cluster7_1 <- mean(cases_long_df_TMT$cluster7_1, na.rm = TRUE)
sd_cluster7_1 <- sd(cases_long_df_TMT$cluster7_1, na.rm = TRUE)

# Define values for +1 SD, Mean, and -1 SD of cluster6_1
cluster6_1_plus1sd <- mean_cluster6_1 + sd_cluster6_1
cluster6_1_mean <- mean_cluster6_1
cluster6_1_minus1sd <- mean_cluster6_1 - sd_cluster6_1

# Define values for +1 SD, Mean, and -1 SD of cluster6_1
cluster3_1_plus1sd <- mean_cluster3_1 + sd_cluster3_1
cluster3_1_mean <- mean_cluster3_1
cluster3_1_minus1sd <- mean_cluster3_1 - sd_cluster3_1

# Define values for +1 SD, Mean, and -1 SD of cluster6_1
cluster7_1_plus1sd <- mean_cluster7_1 + sd_cluster7_1
cluster7_1_mean <- mean_cluster7_1
cluster7_1_minus1sd <- mean_cluster7_1 - sd_cluster7_1

# Subset data based on cluster6_1 SD groups and remove NA values
subset_plus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 > cluster6_1_plus1sd, ]
subset_mean <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 <= cluster6_1_plus1sd & cases_long_df_TMT$cluster6_1 > cluster6_1_minus1sd, ]
subset_minus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1) & cases_long_df_TMT$cluster6_1 <= cluster6_1_minus1sd, ]


# Subset data based on cluster6_1 SD groups and remove NA values
subset_plus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster3_1) & cases_long_df_TMT$cluster3_1 > cluster3_1_plus1sd, ]
subset_mean <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster3_1) & cases_long_df_TMT$cluster3_1 <= cluster3_1_plus1sd & cases_long_df_TMT$cluster3_1 > cluster3_1_minus1sd, ]
subset_minus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster3_1) & cases_long_df_TMT$cluster3_1 <= cluster3_1_minus1sd, ]

# Subset data based on cluster7_1 SD groups and remove NA values
subset_plus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster7_1) & cases_long_df_TMT$cluster7_1 > cluster7_1_plus1sd, ]
subset_mean <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster7_1) & cases_long_df_TMT$cluster7_1 <= cluster7_1_plus1sd & cases_long_df_TMT$cluster7_1 > cluster7_1_minus1sd, ]
subset_minus1sd <- cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster7_1) & cases_long_df_TMT$cluster7_1 <= cluster7_1_minus1sd, ]


# Create a combined data frame for plotting if subsets have rows
plot_data <- NULL
if (nrow(subset_plus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_plus1sd$cluster6_1, group = "+1 SD"))
}
if (nrow(subset_mean) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_mean$cluster6_1, group = "Mean"))
}
if (nrow(subset_minus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster6_1 = subset_minus1sd$cluster6_1, group = "-1 SD"))
}


# Create a combined data frame for plotting if subsets have rows
plot_data <- NULL
if (nrow(subset_plus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster3_1 = subset_plus1sd$cluster3_1, group = "+1 SD"))
}
if (nrow(subset_mean) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster3_1 = subset_mean$cluster3_1, group = "Mean"))
}
if (nrow(subset_minus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster3_1 = subset_minus1sd$cluster3_1, group = "-1 SD"))
}


# Create a combined data frame for plotting if subsets have rows
plot_data <- NULL
if (nrow(subset_plus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster7_1 = subset_plus1sd$cluster7_1, group = "+1 SD"))
}
if (nrow(subset_mean) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster7_1 = subset_mean$cluster7_1, group = "Mean"))
}
if (nrow(subset_minus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster7_1 = subset_minus1sd$cluster7_1, group = "-1 SD"))
}


ggplot(plot_data, aes(x = group, y = cluster6_1, fill = group)) +
  geom_violin(trim = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(x = "Cluster6_1 SD Group", y = "Cluster6_1 Values") +
  ggtitle("Violin Plot of Cluster6_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  theme_minimal()


ggplot(plot_data, aes(x = cluster6_1, fill = group)) +
  geom_density(alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
  facet_wrap(~ group, scales = "free") +
  labs(x = "Cluster6_1 Values", y = "Density", fill = "Group") +
  ggtitle("Density Plot of Cluster6_1 Values by SD Groups") +
  theme_minimal()


ggplot(plot_data, aes(x = group, y = cluster6_1, color = ifelse(cluster6_1 >= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster6_1 SD Group", y = "Cluster6_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster6_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size


ggplot(plot_data, aes(x = group, y = cluster6_1, color = ifelse(cluster6_1 >= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster6_1 SD Group", y = "Cluster6_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster6_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  scale_color_manual(values = c("cornflowerblue", "tomato")) +  # Specify colors for the categories
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size

ggplot(plot_data, aes(x = group, y = cluster3_1, color = ifelse(cluster3_1 >= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster3_1 SD Group", y = "Cluster6_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster3_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  scale_color_manual(values = c("cornflowerblue", "tomato")) +  # Specify colors for the categories
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size

ggplot(plot_data, aes(x = group, y = cluster3_1, color = ifelse(cluster3_1 <= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster7_1 SD Group", y = "Cluster6_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster7_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  scale_color_manual(values = c("cornflowerblue", "tomato")) +  # Specify colors for the categories
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size
```

#10. T. test between cases/controls

```{r}


# Perform the t-test between the age of cases and controls
t_test_result <- t.test(age ~ case_control, data = mvpa_proj)

# Print the result
print(t_test_result)

# Define the list of variables to test
variables_to_test <- c("RAVLTlearnt_two", "RAVLTlearnt_six", "RAVLTlearnt_twelve",
                       "RAVLTsum_two", "RAVLTsum_six", "RAVLTsum_twelve",
                       "WAISscore_two", "WAISscore_six", "WAISscore_twelve",
                       "TMTPartBTime_two", "TMTPartBTime_six", "TMTPartBTime_twelve",
                       "TMTPartATime_two", "TMTPartATime_six", "TMTPartATime_twelve")

# Loop through each variable and perform t-test
for (var in variables_to_test) {
  # Ensure there are no NA values
  df_clean <- mvpa_proj[!is.na(mvpa_proj[[var]]) & !is.na(mvpa_proj$case_control), ]
  
  # Perform the t-test
  t_test_result <- t.test(as.formula(paste(var, "~ case_control")), data = df_clean)
  
  # Print the result
  cat("T-test for", var, ":\n")
  print(t_test_result)
  cat("\n\n")
}


```

#11. ANOVAS between scanners

```{r}
#load datasets from .csv
tracktbi_all <- read_csv("/work/cnelab/fitbir/raw_csv/track_tbi_all_data.csv") 
ids_3scanners_conn <- read_csv("/work/cnelab/fitbir/raw_csv/ids_3scanners_conn.csv")

# merges files based on common col name
tracktbi_mri  <- merge(ids_3scanners_conn, tracktbi_all, by="id", all.x = TRUE)


write.csv(tracktbi_mri,"/work/cnelab/fitbir/raw_csv/track_tbi_mri.csv", row.names=FALSE)
tracktbi_mri <- read_csv("/work/cnelab/fitbir/raw_csv/track_tbi_mri.csv") 


tracktbi_mri_cases <- tracktbi_mri[tracktbi_mri$case_control.y == "Case", ]


tracktbi_mri_cases$scanner <- factor(tracktbi_mri_cases$scanner, levels = c(1, 2, 3), labels = c("Siemens", "GE", "Phillips"))

age_anova <- aov(age ~ scanner, data = tracktbi_mri_cases)
summary(age_anova)

education_anova <- aov(educ ~ scanner, data = tracktbi_mri_cases)
summary(education_anova)

ses_anova <- aov(SES ~ scanner, data = tracktbi_mri_cases)
summary(ses_anova)

sex_table <- table(tracktbi_mri_cases$gender, tracktbi_mri_cases$scanner)
chisq.test(sex_table)


# Load necessary libraries
library(dplyr)

# Check the variable names
names(tracktbi_mri_cases)

# Assuming the variables are correctly named 'sex', 'age', and 'education'
# If the variable names are different, replace them accordingly

# Filter the data based on scanner type and calculate summary statistics
summary_stats <- tracktbi_mri_cases %>%
  group_by(scanner) %>%
  summarise(
    mean_sex = mean(gender, na.rm = TRUE),
    sd_sex = sd(gender, na.rm = TRUE),
    mean_age = mean(age, na.rm = TRUE),
    sd_age = sd(age, na.rm = TRUE),
    mean_education = mean(educ, na.rm = TRUE),
    sd_education = sd(educ, na.rm = TRUE),
    mean_SES = mean(SES, na.rm = TRUE),
    sd_SES = sd(SES, na.rm = TRUE)
  )

# Print the summary statistics
print(summary_stats)


# Count the number of males and females by scanner type
sex_counts_by_scanner <- tracktbi_mri_cases %>%
  group_by(scanner, gender) %>%
  summarise(count = n())

# Print the counts
print(sex_counts_by_scanner)


```

#12. ANCOVAs

```{r}
# Assuming you have a dataframe 'data' with relevant columns
model <- aov(TMTPartATime_twelve ~ case_control + age + educ + sex, data = mvpa_proj)
summary(model)

model <- aov(TMTPartBTime_twelve ~ case_control + age + educ + sex, data = mvpa_proj)
summary(model)

model <- aov(WAISscore_twelve ~ case_control + age + educ + sex, data = mvpa_proj)
summary(model)

model <- aov(RAVLTsum_twelve ~ case_control + age + educ + sex, data = mvpa_proj)
summary(model)

model <- aov(RAVLTlearnt_twelve ~ case_control + age + educ + sex, data = mvpa_proj)
summary(model)
```

#13. Reviewers extra analysis

```{r}


#load datasets from .csv
mvpa_proj <- read_csv("/work/cnelab/fitbir/raw_csv/track_tbi.csv") 

View(mvpa_proj)

cases_mvpa_proj <- mvpa_proj[mvpa_proj$case_control == "Case", ]

# Step 1: Calculate TMT B-A
cases_mvpa_proj <- cases_mvpa_proj %>%
  mutate(TMT_B_minus_A_two = TMTPartBTime_two - TMTPartATime_two)

# Step 1: Calculate TMT B-A
cases_mvpa_proj <- cases_mvpa_proj %>%
  mutate(TMT_B_minus_A_six = TMTPartBTime_six - TMTPartATime_six)

# Step 1: Calculate TMT B-A
cases_mvpa_proj <- cases_mvpa_proj %>%
  mutate(TMT_B_minus_A_twelve = TMTPartBTime_twelve - TMTPartATime_twelve)


# Gather the data into long format (TMTl not normal distributed)
long_df_TMTBA <- gather(cases_mvpa_proj, key = "time", value = "TMT_B_minus_A", TMT_B_minus_A_two, TMT_B_minus_A_six, TMT_B_minus_A_twelve)

# Create a new column based on the values in the "time" column
long_df_TMTBA <- long_df_TMTBA %>%
  mutate(timepoint = case_when(
    time == "TMT_B_minus_A_two" ~ "timepoint1",
    time == "TMT_B_minus_A_six" ~ "timepoint2",
    time == "TMT_B_minus_A_twelve" ~ "timepoint3",
    TRUE ~ NA_character_
  ))


## TMT BA Linear Mixed Effects Model + interaction plot

#cav_data_lmem13$timepoint<- as.factor(cav_data_lmem13$timepoint)
long_df_TMTBA$sex <- as.factor(long_df_TMTBA$sex)
long_df_TMTBA$age <- as.numeric(long_df_TMTBA$age)
long_df_TMTBA$educ <- as.numeric(long_df_TMTBA$educ)
long_df_TMTBA$QC_MeanMotion <- as.numeric(long_df_TMTBA$QC_MeanMotion)
long_df_TMTBA$timepoint[long_df_TMTBA$timepoint == "timepoint1"] <- "1"
long_df_TMTBA$timepoint[long_df_TMTBA$timepoint == "timepoint2"] <- "2"
long_df_TMTBA$timepoint[long_df_TMTBA$timepoint == "timepoint3"] <- "3"
long_df_TMTBA$timepoint <- as.numeric(long_df_TMTBA$timepoint)
long_df_TMTBA$TMTPartATime <- as.numeric(long_df_TMTBA$TMT_B_minus_A)

sum(is.na(long_df_TMTBA$TMT_B_minus_A))


tmtba_tbi_lme1 <- lmer(TMT_B_minus_A ~ cluster1_1 + timepoint*cluster1_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster1_1|id), data = long_df_TMTBA)
tmtba_tbi_lme2 <- lmer(TMT_B_minus_A ~ cluster2_1 + timepoint*cluster2_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster2_1|id), data = long_df_TMTBA)
tmtba_tbi_lme3 <- lmer(TMT_B_minus_A ~ cluster3_1 + timepoint*cluster3_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster3_1|id), data = long_df_TMTBA)
tmtba_tbi_lme4 <- lmer(TMT_B_minus_A ~ cluster4_1 + timepoint*cluster4_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster4_1|id), data = long_df_TMTBA)
tmtba_tbi_lme5 <- lmer(TMT_B_minus_A ~ cluster5_1 + timepoint*cluster5_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster5_1|id), data = long_df_TMTBA)
tmtba_tbi_lme6 <- lmer(TMT_B_minus_A ~ cluster6_1 + timepoint*cluster6_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster6_1|id), data = long_df_TMTBA)
tmtba_tbi_lme7 <- lmer(TMT_B_minus_A ~ cluster7_1 + timepoint*cluster7_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster7_1|id), data = long_df_TMTBA)
tmtba_tbi_lme8 <- lmer(TMT_B_minus_A ~ cluster8_1 + timepoint*cluster8_1 + sex + age + QC_MeanMotion + educ + SES + (1+cluster8_1|id), data = long_df_TMTBA)

summary(tmtba_tbi_lme1)
summary(tmtba_tbi_lme2)
summary(tmtba_tbi_lme3)
summary(tmtba_tbi_lme4)
summary(tmtba_tbi_lme5)
summary(tmtba_tbi_lme6)
summary(tmtba_tbi_lme7)
summary(tmtba_tbi_lme8)

library(sjPlot)
tab_model(tmtba_tbi_lme1,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme2,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme3,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme4,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme5,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme6,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme7,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")
tab_model(tmtba_tbi_lme8,digits=3,digits.re=3,show.df=TRUE,df.method = "satterthwaite")

#CONTROL FOR MULTIPLE COMPARISONS USING FALSE DISCOVERY RATE (FDR)
library(readxl) #need to create excel or csv of pvalues from all models
pvals <- read_excel("Desktop/pvals.xlsx", sheet = "Hoja1")
View(pvals)
pvals$fdrval<-p.adjust(pvals$pvals, method="fdr")



#save csv file
write.csv(pvals,"/work/cnelab/fitbir/MVPA_siemens_project/pvalstmta.csv", row.names=FALSE)

(emmeans) 


# Load required libraries
library(ggplot2)
library(dplyr)
library(interactions)

jn_intervals <- probe_interaction()

# interaction plot of significant cluster
test2 <- probe_interaction(model = tmtba_tbi_lme5, pred = timepoint, modx = cluster5_1, alpha = .05, ci = 0.95, fdr = TRUE) 

test2 


# Calculate mean and SD of cluster5_1
mean_cluster5_1 <- mean(long_df_TMTBA$cluster5_1, na.rm = TRUE)
sd_cluster5_1 <- sd(long_df_TMTBA$cluster5_1, na.rm = TRUE)


# Define values for +1 SD, Mean, and -1 SD of cluster6_1
cluster5_1_plus1sd <- mean_cluster5_1 + sd_cluster5_1
cluster5_1_mean <- mean_cluster5_1
cluster5_1_minus1sd <- mean_cluster5_1 - sd_cluster5_1


# Subset data based on cluster6_1 SD groups and remove NA values
subset_plus1sd <- long_df_TMTBA[!is.na(long_df_TMTBA$cluster5_1) & long_df_TMTBA$cluster5_1 > cluster5_1_plus1sd, ]
subset_mean <- long_df_TMTBA[!is.na(long_df_TMTBA$cluster5_1) & long_df_TMTBA$cluster5_1 <= cluster5_1_plus1sd & long_df_TMTBA$cluster5_1 > cluster5_1_minus1sd, ]
subset_minus1sd <- long_df_TMTBA[!is.na(long_df_TMTBA$cluster5_1) & long_df_TMTBA$cluster5_1 <= cluster5_1_minus1sd, ]

# Create a combined data frame for plotting if subsets have rows
plot_data <- NULL
if (nrow(subset_plus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster5_1 = subset_plus1sd$cluster5_1, group = "+1 SD"))
}
if (nrow(subset_mean) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster5_1 = subset_mean$cluster5_1, group = "Mean"))
}
if (nrow(subset_minus1sd) > 0) {
  plot_data <- rbind(plot_data, data.frame(cluster5_1 = subset_minus1sd$cluster5_1, group = "-1 SD"))
}




ggplot(plot_data, aes(x = group, y = cluster5_1, color = ifelse(cluster5_1 >= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster6_1 SD Group", y = "Cluster5_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster6_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  scale_color_manual(values = c("cornflowerblue", "tomato")) +  # Specify colors for the categories
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size


ggplot(plot_data, aes(x = group, y = cluster5_1, color = ifelse(cluster5_1 <= 0, "Hyperconnected", "Anticorrelated"))) +
  geom_jitter(width = 0.2, alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  labs(x = "Cluster7_1 SD Group", y = "Cluster5_1 Values", color = "Value Position") +
  ggtitle("Scatter Plot of Cluster7_1 Values by SD Groups") +
  scale_x_discrete(limits = c("+1 SD", "Mean", "-1 SD")) +
  scale_color_manual(values = c("cornflowerblue", "tomato")) +  # Specify colors for the categories
  theme_minimal() +
  theme(axis.text = element_text(size = 20))  # Increase axis label size
```

```{r}
# radarplot to sumarrize network overlapping between replicates

# Load required package
library(fmsb)

# Define the data frame for each replicate
replicate1 <- data.frame(
  `Default Mode Network` = c(1),
  `Frontoparietal` = c(2),
  `Salience` = c(0),
  `Dorsal Attention` = c(0),
  `Somatomotor` = c(0),
  `Limbic` = c(1),
  `Visual` = c(1)
)

replicate2 <- data.frame(
  `Default Mode Network` = c(0),
  `Frontoparietal` = c(0),
  `Salience` = c(0),
  `Dorsal Attention` = c(1),
  `Somatomotor` = c(0),
  `Limbic` = c(0),
  `Visual` = c(1)
)

replicate3 <- data.frame(
  `Default Mode Network` = c(3),
  `Frontoparietal` = c(1),
  `Salience` = c(0),
  `Dorsal Attention` = c(1),
  `Somatomotor` = c(0),
  `Limbic` = c(0),
  `Visual` = c(1)
)

# Define max-min ranges
max_min <- data.frame(
  `Default Mode Network` = c(4, 0),
  `Frontoparietal` = c(4, 0),
  `Salience` = c(4, 0),
  `Dorsal Attention` = c(4, 0),
  `Somatomotor` = c(4, 0),
  `Limbic` = c(4, 0),
  `Visual` = c(4, 0)
)

# Combine all data into one plot-ready data frame
techs12_plot <- rbind(max_min, replicate1, replicate2, replicate3)

# Plot the radar chart without variable labels
radarchart(
  techs12_plot, axistype = 1,
  pcol = c("khaki3", "khaki3", "khaki3"),          # Line colors for replicates
  pfcol = c(NA, NA, NA),                                 # No fill colors
  plwd = 2,                                              # Line width
  plty = c(1, 2, 3),                                     # Line types: solid, dashed, dotted
  cglcol = "grey",                                       # Color of grid lines
  cglty = 1,                                             # Type of grid lines
  axislabcol = "grey",                                   # Axis label color
  caxislabels = seq(0, 5, 1),                            # Axis labels
  vlabels = rep("", ncol(techs12_plot)),                 # No variable labels
  vlcex = 0.8                                            # Label size
)

# Add legend to differentiate replicates
legend(
  "topright", legend = c("Replicate 1", "Replicate 2", "Replicate 3"),
  col = c("khaki3", "khaki3", "khaki3"), 
  lty = c(1, 2, 3), 
  lwd = 2, bty = "n", cex = 0.8
)






#Sex differences plots

library(readxl)
mvpa_sex_meanvalues <- read_excel("/work/cnelab/fitbir/raw_csv/mvpa_sex_meanvalues.xlsx")
View(mvpa_sex_meanvalues)

#merge original data with sex differences clusters
mvpa_proj <- merge(mvpa_proj, mvpa_sex_meanvalues, by="id", all.x= TRUE)

mvpa_proj$sex <- as.factor(mvpa_proj$sex)
mvpa_proj$case_control <- as.factor(mvpa_proj$case_control)


ggplot(mvpa_proj, aes(x = mvpa_proj$`cluster +28 -84 +12`, y = mvpa_proj$case_control)) + 
  geom_point(aes(color = factor(mvpa_proj$sex))) + 
  theme(
    # Hide panel borders and remove grid lines
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_blank(),
    legend.position = "none", 
    # Change axis line
    axis.line = element_line(colour = "black")
  ) +
  labs(y="Control", x = "MVPA") +
  stat_smooth(method = "lm", aes(color = factor(mvpa_proj$sex)))

library(ggplot2)

# Your original ggplot code
ggplot(mvpa_proj, aes(x = case_control, y = `cluster -54 -46 -14`, fill = sex)) +
  geom_boxplot(position = position_dodge(1)) +
  
  # Customizing the theme with white background, larger legend, modified x and y axis labels, and increased label size
  theme(
    panel.background = element_rect(fill = "white"),  # Set panel background to white
    panel.grid.major = element_blank(),  # Remove major grid lines
    panel.grid.minor = element_blank(),  # Remove minor grid lines
    legend.background = element_rect(fill = "white", color = "black"),  # Set legend background to white with black border
    legend.key.size = unit(2, "lines"),  # Set the size of the legend items
    
    # Increase the size of x and y axis labels
    axis.title.x = element_text(size = 14),  # Adjust x axis label size
    axis.title.y = element_text(size = 14)   # Adjust y axis label size
  ) +
  
  # Customizing the x and y axis labels
  xlab("Case/Control") +
  ylab("Inferior/Middle Temporal Gyrus FC") +
  
  # Customizing the legend title
  labs(fill = "Biological Sex")

mvpa_proj$`cluster +28 -84 +12`
mvpa_proj$`cluster +2 +22 +46`
mvpa_proj$`cluster +18 -22 -8`
mvpa_proj$`cluster -54 -46 -14`


```

#14. Reviewers responses 2 

```{r}

#prepare data for prediction model

# Load necessary libraries
library(readxl)

# Load the Siemens, GE, and Phillips datasets
ge_data <- read.csv("/work/cnelab/fitbir/raw_csv/prediction_model/ge_zscores.csv")
phillips_data <- read.csv("/work/cnelab/fitbir/raw_csv/prediction_model/phillips_zscores.csv")
siemens_data <- read_xlsx("/work/cnelab/fitbir/raw_csv/prediction_model/siemens_zscores.xlsx")
cases_controls<- read_xlsx("/work/cnelab/fitbir/raw_csv/prediction_model/tracktbi_alldata_cases_controls.xlsx")

# merges files based on common col name
ge_data <- merge(ge_data, cases_controls, by="id", all.x = TRUE)

# merges files based on common col name
phillips_data <- merge(phillips_data, cases_controls, by="id", all.x = TRUE)

# merges files based on common col name
siemens_data <- merge(siemens_data, cases_controls, by="id", all.x = TRUE)






# Median split cognitin at 6 months and see if change in MVPA over time is related to change in cognition 
# Compute the median of cognition at 6 months

median_tmt6 <- median(cases_mvpa_proj$TMTPartBTime_six, na.rm = TRUE)

# Create a binary variable for the median split
cases_mvpa_proj$cognition_split_6m <- ifelse(cases_mvpa_proj$TMTPartBTime_six > median_tmt6, 1, 0)



cases_mvpa_long <- cases_mvpa_proj %>%
  pivot_longer(
    cols = starts_with("cluster6_1"),  # Select only MVPA timepoints
    names_to = "timepoint", 
    values_to = "MVPA"
  )


cases_mvpa_proj$change_mvpa <- cases_mvpa_proj$cluster6_1_T2 - cases_mvpa_proj$cluster6_1_T1


model <- lm(change_mvpa ~ cognition_split_6m, data = cases_mvpa_proj)

summary(model)




library(lme4)
library(emmeans)
library(ggplot2)

# Compute mean and SD of cluster3_1
mean_cluster3_1 <- mean(cases_long_df_TMTA$cluster3_1, na.rm = TRUE)
sd_cluster3_1 <- sd(cases_long_df_TMTA$cluster3_1, na.rm = TRUE)

# Define values: mean, +1SD, -1SD
values_cluster3_1 <- c(mean_cluster3_1 - sd_cluster3_1, mean_cluster3_1, mean_cluster3_1 + sd_cluster3_1)

# Get estimated marginal means
emm <- emmeans(tmta_tbi_lme3, ~ cluster3_1, at = list(cluster3_1 = values_cluster3_1))

# Perform ANOVA
anova_results <- joint_tests(emm)
print(anova_results)

# Convert to dataframe for plotting
emm_df <- as.data.frame(emm)

# Plot estimated values
ggplot(emm_df, aes(x = factor(cluster3_1), y = emmean)) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.1) +
  labs(x = "Cluster3_1 Values (-1SD, Mean, +1SD)", y = "Estimated TMT Part A Time",
       title = "Effect of Cluster3_1 on TMT Part A Time") +
  theme_minimal()





library(car)  

mean_cluster3_1 <- mean(cases_long_df_TMTA$cluster3_1, na.rm = TRUE)
sd_cluster3_1 <- sd(cases_long_df_TMTA$cluster3_1, na.rm = TRUE)

cases_long_df_TMTA$cluster3_1_category <- cut(
  cases_long_df_TMTA$cluster3_1, 
  breaks = c(-Inf, mean_cluster3_1 - sd_cluster3_1, mean_cluster3_1 + sd_cluster3_1, Inf), 
  labels = c("-1 SD", "Mean", "+1 SD")
)

anova_model <- aov(TMTPartATime ~ cluster3_1_category, data = cases_long_df_TMTA)
summary(anova_model)

cases_long_df_TMTA_clean <- cases_long_df_TMTA[!is.na(cases_long_df_TMTA$cluster3_1_category) & !is.na(cases_long_df_TMTA$TMTPartATime), ]

ggplot(cases_long_df_TMTA_clean, aes(x = cluster3_1_category, y = TMTPartATime, fill = cluster3_1_category)) +
  geom_boxplot() +
  labs(title = "Boxplot of TMTPartATime by cluster3_1_category",
       x = "Cluster3_1 Category",
       y = "TMT Part A Time") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")  # Optional: for coloring the boxplots



# For TMTPartATime + cluster7_1
mean_cluster7_1 <- mean(cases_long_df_TMTA$cluster7_1, na.rm = TRUE)
sd_cluster7_1 <- sd(cases_long_df_TMTA$cluster7_1, na.rm = TRUE)

cases_long_df_TMTA$cluster7_1_category <- cut(
  cases_long_df_TMTA$cluster7_1, 
  breaks = c(-Inf, mean_cluster7_1 - sd_cluster7_1, mean_cluster7_1 + sd_cluster7_1, Inf), 
  labels = c("-1 SD", "Mean", "+1 SD")
)

# Run ANOVA for TMTPartATime
anova_model_TMTPartATime <- aov(TMTPartATime ~ cluster7_1_category, data = cases_long_df_TMTA)
summary(anova_model_TMTPartATime)

# Boxplot for TMTPartATime
ggplot(cases_long_df_TMTA[!is.na(cases_long_df_TMTA$cluster7_1_category) & !is.na(cases_long_df_TMTA$TMTPartATime), ], 
       aes(x = cluster7_1_category, y = TMTPartATime, fill = cluster7_1_category)) +
  geom_boxplot() +
  labs(title = "Boxplot of TMTPartATime by Cluster7_1 Category",
       x = "Cluster7_1 Category", 
       y = "TMT Part A Time") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")

# For TMTPartBTime + cluster6_1
mean_cluster6_1 <- mean(cases_long_df_TMT$cluster6_1, na.rm = TRUE)
sd_cluster6_1 <- sd(cases_long_df_TMT$cluster6_1, na.rm = TRUE)

cases_long_df_TMT$cluster6_1_category <- cut(
  cases_long_df_TMT$cluster6_1, 
  breaks = c(-Inf, mean_cluster6_1 - sd_cluster6_1, mean_cluster6_1 + sd_cluster6_1, Inf), 
  labels = c("-1 SD", "Mean", "+1 SD")
)

# Run ANOVA for TMTPartBTime
anova_model_TMTPartBTime <- aov(TMTPartBTime ~ cluster6_1, data = cases_long_df_TMT)
summary(anova_model_TMTPartBTime)

# Boxplot for TMTPartBTime
ggplot(cases_long_df_TMT[!is.na(cases_long_df_TMT$cluster6_1_category) & !is.na(cases_long_df_TMT$TMTPartBTime), ], 
       aes(x = cluster6_1_category, y = TMTPartBTime, fill = cluster6_1_category)) +
  geom_boxplot() +
  labs(title = "Boxplot of TMTPartBTime by Cluster6_1 Category",
       x = "Cluster6_1 Category", 
       y = "TMT Part B Time") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3")

```

# 15. Reviewers responses 3

```{r}
# Load required library
library(ggplot2)

# Create sample data frame with only the three specified networks
data <- data.frame(
  Network = c("Frontoparietal Network", "Dorsal Attention Network", "Limbic Network"),
  Cluster = c(1, 1, 1)  # All set to 1 for this example
)

# Define adjusted colors based on your feedback
network_colors <- c(
  "Frontoparietal Network" = "#FFBB66",  # Lighter orange for Frontoparietal
  "Dorsal Attention Network" = "#66AA66", # Less bright green for Dorsal Attention
  "Limbic Network" = "#0000AA"           # Dark blue for Limbic (unchanged)
)

# Create bar plot with the adjusted colors
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4




# Create sample data frame with Visual Network added
data <- data.frame(
  Network = c("Visual Network", "Frontoparietal Network"),
  Cluster = c(1, 1)  # Both set to 1 for this example
)

# Define colors for the two networks
network_colors <- c(
  "Visual Network" = "#9933CC",        # Purple for Visual Network
  "Frontoparietal Network" = "#FFBB66" # Light orange for Frontoparietal (as before)
)

# Create bar plot with the two networks
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4




# Create sample data frame with only Dorsal Attention Network
data <- data.frame(
  Network = c("Dorsal Attention Network"),
  Cluster = c(1)  # Set to 1 for this example
)

# Define color for the Dorsal Attention Network
network_colors <- c(
  "Dorsal Attention Network" = "#66AA66" # Muted green for Dorsal Attention Network
)

# Create bar plot with just the Dorsal Attention Network
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4






# Create sample data frame with proper cluster counts
data <- data.frame(
  Network = c("Frontoparietal Network", "Dorsal Attention Network", "Salience Network"),
  Cluster = c(2, 1, 1)  # FPN has 2 clusters, others have 1
)

# Define colors for the networks
network_colors <- c(
  "Frontoparietal Network" = "#FFBB66",  # Light orange for Frontoparietal
  "Dorsal Attention Network" = "#66AA66", # Muted green for Dorsal Attention
  "Salience Network" = "#D653D6"         # Purple for Salience
)

# Create bar plot with the specified networks and correct cluster counts
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4




# Create sample data frame with just Salience and FPN
data <- data.frame(
  Network = c("Frontoparietal Network", "Salience Network"),
  Cluster = c(1, 1)  # Both with 1 cluster
)

# Define colors for the networks
network_colors <- c(
  "Frontoparietal Network" = "#FFBB66", # Light orange for Frontoparietal
  "Salience Network" = "#D653D6"        # Purple for Salience
)

# Create bar plot with the two networks
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4





# Create sample data frame with the five specified networks
data <- data.frame(
  Network = c("Salience Network", "Default Mode Network", 
              "Dorsal Attention Network", "Visual Network", "Limbic Network"),
  Cluster = c(1, 1, 1, 1, 1)  # All with 1 cluster
)

# Define colors for the networks
network_colors <- c(
  "Salience Network" = "#D653D6",       # Purple for Salience
  "Default Mode Network" = "#E07B91",   # Pink color from your image for DMN
  "Dorsal Attention Network" = "#66AA66", # Muted green for DAN
  "Visual Network" = "#9933CC",         # Purple for Visual Network
  "Limbic Network" = "#0000AA"          # Dark blue for Limbic
)

# Create bar plot with the five networks
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4



# Load required library
library(ggplot2)

# Create sample data frame with only Visual Network
data <- data.frame(
  Network = c("Visual Network"),
  Cluster = c(1)  # 1 cluster
)

# Define color for the Visual Network
network_colors <- c(
  "Visual Network" = "#9933CC"  # Purple for Visual Network
)

# Create bar plot with just the Visual Network
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4



# Load required library
library(ggplot2)

# Create sample data frame with only Somatomotor Network
data <- data.frame(
  Network = c("Somatomotor Network"),
  Cluster = c(3)  # 3 clusters as you specified
)

# Define color for the Somatomotor Network
network_colors <- c(
  "Somatomotor Network" = "#5B7BC0"  # Blue color from your image
)

# Create bar plot with the Somatomotor Network
ggplot(data, aes(x = Network, y = Cluster, fill = Network)) +
  geom_bar(stat = "identity", width = 0.7) +
  labs(title = "Brain Networks by Cluster",
       x = "Network Type",
       y = "Cluster Count") +
  theme_minimal() +
  scale_fill_manual(values = network_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(0, 4)  # Set y-axis limits from 0 to 4
```

